// Packet.cpp: implementation of the CPacket class.
//
//////////////////////////////////////////////////////////////////////

#include "stdafx.h"
#include "RemoteControl.h"
#include "Packet.h"
#include "..\MiNiClient\MiniClientDef.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

//////////////////////////////////////////////////////////////////////
// Construction/Destruction
//////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
CPacket::CPacket()
{
	m_sPacket = _T("");
}

/////////////////////////////////////////////////////////////////////////////
CPacket::~CPacket()
{

}

/////////////////////////////////////////////////////////////////////////////
void CPacket::SetPacketMsg(const CStringA &sMsg)
{
	m_sPacket = sMsg;
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetPacketMsg()
{
	return m_sPacket;
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetPacketCheckSum()
{
	return AsciiToInt(PTHEADER_CHECKSUM);
}

/////////////////////////////////////////////////////////////////////////////
DWORD CPacket::GetPacketLength()
{
	return AsciiToInt(PTHEADER_PACKETLENGTH);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetPacketID()
{
	return ExtractSubString(PTHEADER_PACKETID);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetPacketCounter()
{
	return AsciiToInt(PTHEADER_PACKETCOUNTER);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetApplicationID()
{
	return ExtractSubString(PTHEADER_APPLICATIONID);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetPacketType()
{
	return AsciiToInt(PTHEADER_PACKETTYPE);
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype00
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType00StatusCode()
{
	return AsciiToInt(PT00_STATUSCODE);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType00MaxErrors()
{
	return AsciiToInt(PT00_MAXERRORS);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType00TimeOut()
{
	return AsciiToInt(PT00_TIMEOUT);
}

/////////////////////////////////////////////////////////////////////////////
DWORD CPacket::GetType00WorkerPort()
{
	return AsciiToInt(PT00_WORKERPORT);
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype01
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType01MaxCam()
{
	return AsciiToInt(PT01_KAMERAZAHL);
}

/////////////////////////////////////////////////////////////////////////////
BOOL CPacket::GetType01CamOnOff(WORD wCamera)
{
	wCamera -= 1; // Kameras werden außen von 1 an gezählt

	if (ExtractSubString(PT01_KAMERAONOFF(wCamera)) == _T("J"))
		return TRUE;
	else
		return FALSE;
}

/////////////////////////////////////////////////////////////////////////////
CRect CPacket::GetType01WndPos(WORD wCamera)
{
	CRect Rect;

	wCamera -= 1; // Kameras werden außen von 1 an gezählt

	Rect.top	= AsciiToInt(PT01_TOP(wCamera));	
	Rect.left	= AsciiToInt(PT01_LEFT(wCamera));
	Rect.right	= Rect.left + AsciiToInt(PT01_WIDTH(wCamera));
	Rect.bottom	= Rect.top	+ AsciiToInt(PT01_HEIGHT(wCamera));

	return Rect;
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype02
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
CStringA	CPacket::GetType02FileName()
{
	return ExtractSubString(PT02_FILENAME);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02ContainerPrefix()
{
	return ExtractSubString(PT02_CONTAINERPREFIX);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02ContainerNumber()
{
	return ExtractSubString(PT02_CONTAINERNUMBER);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02ISOCode()
{
	return ExtractSubString(PT02_ISOCODE);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02IMDGCode1()
{
	return ExtractSubString(PT02_IMDGCODE1);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02IMDGCode2()
{
	return ExtractSubString(PT02_IMDGCODE2);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02SpecialID()
{
	return ExtractSubString(PT02_SPECIAL_ID);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02Rufzeichen()
{
	return ExtractSubString(PT02_RUFZEICHEN);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02ReiseNummer()
{
	return ExtractSubString(PT02_REISENUMMER);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02Reeder()
{
	return ExtractSubString(PT02_REEDER);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02SiegelNummer()
{
	return ExtractSubString(PT02_SIEGELNUMMER);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02Direction()
{
	return ExtractSubString(PT02_DIRECTION);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02DamageCode()
{
	return ExtractSubString(PT02_DAMAGECODE);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02Date()
{
	return ExtractSubString(PT02_DATE);
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::GetType02Time()
{
	return ExtractSubString(PT02_TIME);
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype03
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType03Camera(WORD wCamera)
{
	wCamera -= 1; // Kameras werden außen von 1 an gezählt

	return AsciiToInt(PT03_CAMERA(wCamera));
}

/////////////////////////////////////////////////////////////////////////////
int CPacket::GetType03Action(WORD wCamera)
{
	int nRet = 0;
	wCamera -= 1; // Kameras werden außen von 1 an gezählt

	if (ExtractSubString(PT03_ACTION(wCamera)) == _T("F"))
		nRet = FREEZE_IT;
	else if (ExtractSubString(PT03_ACTION(wCamera)) == _T("A"))
		nRet = SHOW_IT;
	else if (ExtractSubString(PT03_ACTION(wCamera)) == _T("R"))
		nRet = REFRESH_IT;
	else
		WK_TRACE_ERROR(_T("GetType03Action for Camera %u unknown (%s)\n"), wCamera, ExtractSubString(PT03_ACTION(wCamera)));
	
	return nRet;
}

/////////////////////////////////////////////////////////////////////////////
BOOL CPacket::GetType03Minimized(WORD wCamera)
{
	wCamera -= 1; // Kameras werden außen von 1 an gezählt

	if (ExtractSubString(PT03_VIEW(wCamera)) == _T("M"))
		return TRUE;
	else
		return FALSE;
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype04
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType04MaxCam()
{
	return AsciiToInt(PT04_KAMERAZAHL);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType04Camera()
{
	return AsciiToInt(PT04_KAMERA);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType04Brightness()
{
	return AsciiToInt(PT04_BRIGHTNESS);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType04Contrast()
{
	return AsciiToInt(PT04_CONTRAST);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType04Saturation()
{
	return CPacket::AsciiToInt(PT04_SATURATION);
}

/////////////////////////////////////////////////////////////////////////////
BOOL CPacket::GetType04IsZoomed()
{
	if (ExtractSubString(PT04_VIEWTYPE) == _T("Z"))
		return TRUE;
	else
		return FALSE;
}

/////////////////////////////////////////////////////////////////////////////
// Telegrammtype05
/////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType05Camera()
{
	return AsciiToInt(PT05_KAMERA);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::GetType05StatusCode()
{
	return AsciiToInt(PT05_STATUSCODE);
}

/////////////////////////////////////////////////////////////////////////////
WORD CPacket::AsciiToInt(WORD wI, WORD wSize)
{
	if (m_sPacket.GetLength() >= wI + wSize)
		return (WORD)atoi(m_sPacket.Mid(wI, wSize));
	else
	{
		WK_TRACE_ERROR(_T("AsciiToInt Index wrong\n"));
		return (WORD)0;
	}
}

/////////////////////////////////////////////////////////////////////////////
CStringA CPacket::ExtractSubString(WORD wI, WORD wSize)
{
	if (m_sPacket.GetLength() >= wI + wSize)
		return m_sPacket.Mid(wI, wSize);
	else
	{
		WK_TRACE_ERROR(_T("ExtractSubString Index wrong\n"));
		return _T("");
	}
}	